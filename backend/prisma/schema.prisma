generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum WarehouseNodeType {
  Warehouse
  Aisle
  Rack
  Bin
}

enum InventoryMethod {
  FIFO
  LIFO
  FEFO
}

enum EntityStatus {
  Active
  Inactive
}

model Warehouse {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  node_id     String            @unique @db.VarChar(255)
  name        String            @unique @db.VarChar(255)
  parent_id   String?           @db.Uuid
  node_type   WarehouseNodeType
  method      InventoryMethod   @default(FIFO)
  address     String            @db.Text
  description String?           @db.Text
  status      EntityStatus      @default(Active)

  // Audit columns
  created_at  DateTime          @default(now()) @db.Timestamptz
  created_by  String?           @db.Uuid
  updated_at  DateTime          @updatedAt @db.Timestamptz
  updated_by  String?           @db.Uuid

  // Soft delete columns
  deleted_at  DateTime?         @db.Timestamptz
  deleted_by  String?           @db.Uuid

  // Relations
  parent      Warehouse?        @relation("WarehouseHierarchy", fields: [parent_id], references: [id], onDelete: Restrict, onUpdate: Cascade)
  children    Warehouse[]       @relation("WarehouseHierarchy")

  @@index([parent_id], name: "idx_warehouses_parent_id")
  @@index([created_at], name: "idx_warehouses_created_at")
  @@index([deleted_at], name: "idx_warehouses_deleted_at")
  @@index([created_at, id], name: "idx_warehouses_created_at_id")
  @@map("warehouses")
}